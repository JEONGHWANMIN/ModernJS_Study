# <span style="color: #299191;">**23.4 실행 컨텍스트 스택**

```js
const x = 1;

function foo() {
  const y = 2;

  function bar() {
    const z = 3;
    console.log(x + y + z);
  }
  bar();
}

foo(); // 6
```

<span style="color: magenta;">**_전역코드 & 함수코드_**

_- 전역 코드를 평가하여 실행 컨텍스트 생성_

_- 함수 호출시 함수 코드 평가하여 실행 컨텍스트 생성_

이때 생성된 실행 컨텍스트는 스택 자료구조로 관리된다.

이를 실행 컨텍스트 스택이라고 부른다.

---

<br>

## <span style="color: #d39e9e;">**1. 전역 코드의 평가와 실행**

<br>

전역 실행 컨텍스트를 스택에 푸시함

전역 변수 `x`와 전역함수 `foo`는 전역 실행 컨텍스트에 등록된다

전역 코드가 실행되면 전역 변수 `x`에 값이 할당되고 `foo`가 호출됨

<br>

## <span style="color: #d39e9e;">**2. `foo` 함수 코드의 평가와 실행**

<br>

`foo`가 호출되면 전역 코드의 실행이 중단되고, 코드 제어권이 `foo` 함수 내부로 이동됨

`foo`함수 실행 컨텍스트를 생성하고 스택에 푸시함

지역변수 `y`와 중첩 함수 `bar`가 `foo` 함수 실행 컨덱스트에 등록됨

`foo` 함수 코드가 실행되면 지역변수 `y`에 값 할당, 중첩함수 `bar` 호출

<br>

## <span style="color: #d39e9e;">**3. `bar` 함수 코드의 평가와 실행**

<br>

`bar`가 호출되면 `foo` 함수 코드의 실행이 중단되고, 코드 제어권이 `bar` 함수 내부로 이동됨

`bar`함수 실행 컨텍스트를 생성하고 스택에 푸시함

지역 변수 `z`가 실행 컨텍스트에 등록됨

`bar` 함수 코드가 실행되면 지역 변수 `z` 에 값이 할당되고, 메서드를 호출할 후 `bar` 종료

<br>

## <span style="color: #d39e9e;">**4. `foo` 함수 코드로 복귀**

<br>

`bar` 가 종료되면 `foo` 로 코드 제어권이 다시 이동됨

`bar` 를 스택에서 팝 하여 제거함

`foo` 는 실행 코드 없으므로 종료

<br>

## <span style="color: #d39e9e;">**5. 전역 코드로 복귀**

<br>

`foo` 가 종료되면 전역 코드로 코드 제어권이 다시 이동됨

`foo` 를 스택에서 팝 하여 제거함

실행할 코드가 없으므로 전역 실행 컨텍스트로 스텍에서 팝하여 제거

<br>

_- 실행 컨텍스트 스택은 코드의 실행 순서를 관리_

_- 실행 컨텍스트 스택의 최상위에는 현재 실행중인 실행 컨텍스트가 존재함_

_- 실행 중인 실행 컨텍스트_

<br>

---

<br>

# <span style="color: #299191;">**23.6 실행 컨텍스트의 생성과 식별자 검색 과정**

## <span style="color: #d39e9e;">**23.6.5 `foo` 함수 코드 실행**

<br>

런타임이 시작되면 `foo`함수의 소스코드가 순차적으로 실행된다.

매개변수에 인수가 할당되고, 변수 할당문에 의해 `x`,`y` 에 값이 할당된다.

함수 `bar`가 호출된다.

<br>

> <span style="color: #f6b65a;">식별자 검색을 위해 실행중인 실행 컨텍스트의 렉시컬 환경에서 식별자를 검색하기 시작한다. 검색이 완료되면 검색된 식별자에 값을 바인딩한다.

_- 만약 실행중인 실행 컨텍스트의 렉시컬 환경에서 식별자를 검색할 수 없으면 외부 렉시컬 환경에 대한 참조가 가리키는 렉시컬 환경으로 이동하여 식별자를 검색한다._

<br>

---

<br>

## <span style="color: #d39e9e;">**23.6.6 `bar` 함수 코드 평가**

```js
var x = 1;
const y = 2;

function foo(a) {
  var x = 3;
  const y = 4;

  function bar(b) {
    const z = 5;
    console.log(a + b + x + y + z);
  }
  bar(10); // <- 호출 직전
}

foo(20);
```

`bar` 함수가 호출되면 `bar` 함수 내부로 코드 제어권이 이동하고, `bar` 함수 코드를 평가한다.

<br>

---

<br>

## <span style="color: #d39e9e;">**23.6.7 `bar` 함수 코드 실행**

<br>

런타임이 시작되어 `bar` 함수의 소스코드가 순차적으로 실행된다.

매개변수에 인수가 할당되고, 변수 할당문이 실행되어 지역 변수 `z`에 값이 할당된다.

`console.log(a + b + x + y + z);` 가 실행된다.

---

<br>

### <span style="color: #6868ac;">**_1. `console` 식별자 검색_**

<br>

먼저 `console` 식별자를 스코프 체인에서 검색한다. <sup>(_식별자 검색은 언제나 현재 실행 중인 실행 컨텍스트의 렉시컬 환경에서 검색을 시작한다._)

```js
'bar' -> 'foo' -> '전역 렉시컬 환경' 순으로 이동하여 검색을 시작한다.

전역 렉시컬 환경은 객체 환경 레코드와 선언적 환경 레코드로 구성된다.

console 식별자는 객체 환경 레코드의 'BindingObject' 를 통해 찾을 수 있다.
```

<br>

### <span style="color: #6868ac;">**_2. `log` 식별자 검색_**

<br>

`console` 식별자에 바인딩된, `console` 객체에서 `log` 메서드를 검색한다.

이때 `console` 객체의 프로토타입 체인을 통해 검색한다. <sup>(`log` 메서드는 상속된 프로퍼티가 아니고, `console` 객체가 직접 소유하는 프로퍼티이다.)

```js
console.hasOwnProperty("log"); // -> true
```

<br>

### <span style="color: #6868ac;">**_3. 표현식 `a + b + x + y + z` 의 평가_**

<br>

`console.log` 에 전달할 표현식 `a + b + x + y + z` 의 평가를 위해 각 식별자를 검색한다.

```
a      ->    foo
b      ->    bar
x, y   ->    foo
z      ->    bar

의 렉시컬 환경에서 검색된다.
```

<br>

### <span style="color: #6868ac;">**_4. `console.log` 메서드 호출_**

<br>

표현식 `a + b + x + y + z` 이 평가되어 `42` <sup>`(20 + 10 + 3 + 4 + 5)`</sup> 를 `console.log` 에 전달하여 호출한다.

<br>

---

<br>
